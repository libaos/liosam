<launch>
  <!-- Orchard-tuned move_base_benchmark using TebLocalPlannerROS (real-robot friendly). -->

  <param name="/use_sim_time" value="false" />

  <arg name="log_filename" default="$(find move_base_benchmark)/launch/log.txt" />
  <arg name="map_filename" default="/root/Downloads/map.yaml" />
  <arg name="global_frame" default="map" />
  <arg name="local_frame" default="odom_est" />
  <arg name="base_frame" default="base_link_est" />

  <!-- Odometry topic for navigation (override as needed) -->
  <arg name="odom_topic" default="liorl/mapping/odometry_incremental" />

  <!-- Param files -->
  <arg name="costmap_common_params" default="$(find move_base_benchmark)/params/orchard_costmap_common_params.yaml" />
  <arg name="global_costmap_params" default="$(find move_base_benchmark)/params/global_costmap_params.yaml" />
  <arg name="local_costmap_params" default="$(find move_base_benchmark)/params/orchard_local_costmap_params.yaml" />
  <arg name="local_planner_params" default="$(find move_base_benchmark)/params/orchard_teb_local_planner_params.yaml" />
  <!-- Optional overrides (load after local_planner_params) -->
  <arg name="local_planner_override_params" default="" />

  <!-- Navigation -->
  <node pkg="move_base_benchmark" type="move_base_benchmark" respawn="false" name="move_base_benchmark" output="screen">
    <rosparam file="$(arg costmap_common_params)" command="load" ns="global_costmap" />
    <rosparam file="$(arg costmap_common_params)" command="load" ns="local_costmap" />
    <rosparam file="$(arg global_costmap_params)" command="load" />
    <rosparam file="$(arg local_costmap_params)" command="load" />

    <param name="global_costmap/global_frame" value="$(arg global_frame)" />
    <param name="local_costmap/global_frame" value="$(arg local_frame)" />
    <param name="global_costmap/robot_base_frame" value="$(arg base_frame)" />
    <param name="local_costmap/robot_base_frame" value="$(arg base_frame)" />

    <param name="base_global_planner" value="global_planner/GlobalPlanner" />
    <param name="planner_frequency" value="10.0" />
    <param name="planner_patience" value="5.0" />

    <param name="base_local_planner" value="teb_local_planner/TebLocalPlannerROS" />
    <rosparam file="$(arg local_planner_params)" command="load" />
    <rosparam if="$(eval arg('local_planner_override_params') != '')" file="$(arg local_planner_override_params)" command="load" />
    <param name="controller_frequency" value="10.0" />
    <param name="controller_patience" value="15.0" />

    <param name="log_filename" value="$(arg log_filename)" />
    <remap from="odom" to="$(arg odom_topic)" />
  </node>

  <!-- Map -->
  <node name="map_server" pkg="map_server" type="map_server" args="$(arg map_filename)" output="screen">
    <param name="frame_id" value="$(arg global_frame)" />
  </node>

  <!-- RViz (optional) -->
  <node name="rviz" pkg="rviz" type="rviz" args="-d $(find move_base_benchmark)/launch/rviz_navigation.rviz" />
</launch>
